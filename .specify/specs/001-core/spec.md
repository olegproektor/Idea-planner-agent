# Feature Specification: 001-core ‚Äî Telegram Bot ¬´idea_planner_agent¬ª (RU market)

**Feature Branch**: `001-core`  
**Created**: 14.12.2025  
**Status**: Draft  
**Input**: Telegram messages sent to `@ideaplanneragent_bot`

**Primary references (gates):**
- Project context: `PROJECT-CONTEXT.md`
- Constitution: `.specify/constitution.md`

---

## Overview

### Product intent

–°–¥–µ–ª–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç –¥–ª—è –†–§ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ frictionless: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–¥–µ—é –≤ Telegram-–±–æ—Ç –∏ –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã–π —Ñ–∞–∫—Ç–∞–º–∏ (WB/Ozon/Yandex) –æ—Ç—á—ë—Ç –∏–∑ 7 —Å–µ–∫—Ü–∏–π.

### Interface decision: Telegram Bot (NOT CLI)

**Rationale (RU market):**
- Telegram ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã–π –∫–∞–Ω–∞–ª (post-sanctions, mobile-first)
- –ë—ã—Å—Ç—Ä—ã–π onboarding (–±–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)
- Viral loops: –ø–µ—Ä–µ—Å—ã–ª–∫–∞ –æ—Ç—á—ë—Ç–∞ –ø–∞—Ä—Ç–Ω—ë—Ä–∞–º

### Non-goals (explicit)

- PDF-—ç–∫—Å–ø–æ—Ä—Ç: –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ñ–∏—á–∞ `002-export` (–Ω–µ –≤—Ö–æ–¥–∏—Ç –≤ 001-core)
- Web UI: –Ω–µ –≤—Ö–æ–¥–∏—Ç –≤ 001-core

---

## User Scenarios & Testing *(mandatory)*

> –í–∞–∂–Ω–æ: –≤—Å–µ User Stories –Ω–∏–∂–µ ‚Äî **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ** –∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ 001-core.

### User Story 1 ‚Äî Basic Telegram Bot Evaluation (Priority: P1)

**As a** Russian solopreneur  
**I want** to send my idea to `@ideaplanneragent_bot` in Telegram  
**So that** I receive 7-section analysis in <2 min with WB/Ozon data

**Why this priority:**
–≠—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π ¬´aha moment¬ª –ø—Ä–æ–¥—É–∫—Ç–∞ –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π end-to-end flow.

**Independent Test:**
E2E —Ç–µ—Å—Ç/—Ä—É—á–Ω–æ–π –ø—Ä–æ–≥–æ–Ω –≤ Telegram:
1) `/start`
2) —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∏–¥–µ–µ–π
3) –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
4) –ø—Ä–æ–≤–µ—Ä–∫–∞ 7 —Å–µ–∫—Ü–∏–π –∏ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫-—Ü–∏—Ç–∞—Ç

**Acceptance Criteria:**
- [ ] Telegram bot –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ `/start` (–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ + –∫—Ä–∞—Ç–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è)
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –∏–¥–µ–∏ ‚Üí –∞–Ω–∞–ª–∏–∑ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- [ ] –ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º `‚è≥ –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é...` (–¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è edit message –ø–æ –º–µ—Ä–µ —à–∞–≥–æ–≤)
- [ ] –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à—ë–Ω **< 2 –º–∏–Ω—É—Ç (p90)**
- [ ] –û—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç **7 —Å–µ–∫—Ü–∏–π** –≤ —Å—Ç—Ä–æ–≥–æ–º –ø–æ—Ä—è–¥–∫–µ:
  1. **–ö–ê–†–¢–û–ß–ö–ê –ò–î–ï–ò**: Problem, Solution, Target Audience, Market Size, Competitors, Monetization, Risks
  2. **–ü–û–ß–ï–ú–£ –°–ï–ô–ß–ê–°**: Timing factors, Policy/regulatory changes, Consumer behavior trends, Window of opportunity
  3. **–†–´–ù–û–ß–ù–´–ô –†–ê–ó–†–´–í**: What's missing in market, Why existing solutions fail, Your unique angle
  4. **–ù–ï–î–û–°–¢–ê–Æ–©–ò–ï –î–ê–ù–ù–´–ï**: 10 critical questions for founder to validate
  5. **–î–û–ö–ê–ó–ê–¢–ï–õ–¨–°–¢–í–ê –ò –°–ò–ì–ù–ê–õ–´**: Demand validation (WB/Ozon/Yandex data), Competitor signals, Price analysis
  6. **–ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô**: 30-day week-by-week action breakdown
  7. **–ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò**: 3-12 month roadmap with key stages/milestones
- [ ] Each section formatted for mobile (max 3 sentences per paragraph, emoji for structure)
- [ ] –¶–∏—Ç–∞—Ç—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ WB/Ozon/Yandex (–ø–æ–¥—Ö–æ–¥—è—â–∏–µ –¥–ª—è Telegram)
- [ ] –í—ã–ø–æ–ª–Ω–µ–Ω—ã –≤—Å–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ **AC-1..AC-4** (—Å–º. —Ä–∞–∑–¥–µ–ª "US-3" –∏ Appendix)

---

### User Story 2 ‚Äî Mode Detection in Telegram (Priority: P1)

**As a** power user  
**I want** to type `–†–ï–ñ–ò–ú: –ë–ò–ó–ù–ï–°-–ü–õ–ê–ù –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ –ø–æ—Å—É–¥—ã`  
**So that** I get investor-focused analysis

**Why this priority:**
–†–µ–∂–∏–º—ã ‚Äî –∫–ª—é—á–µ–≤–æ–µ –æ—Ç–ª–∏—á–∏–µ –∏ –±—ã—Å—Ç—Ä—ã–π —Ä–æ—Å—Ç —Ü–µ–Ω–Ω–æ—Å—Ç–∏ –±–µ–∑ UI.

**Independent Test:**
–î–≤–∞ –∑–∞–ø—Ä–æ—Å–∞ —Å –æ–¥–Ω–æ–π –∏–¥–µ–µ–π:
1) –±–µ–∑ —Ä–µ–∂–∏–º–∞ (default)
2) —Å `–†–ï–ñ–ò–ú: –ë–ò–ó–ù–ï–°-–ü–õ–ê–ù`
–°—Ä–∞–≤–Ω–∏—Ç—å: —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ 7 —Å–µ–∫—Ü–∏–π —Å–æ–≤–ø–∞–¥–∞–µ—Ç, –Ω–æ –∞–∫—Ü–µ–Ω—Ç—ã –∏ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ä–µ–∂–∏–º—É.

**Acceptance Criteria:**
- [ ] Regex –¥–µ—Ç–µ–∫—Ç–∏—Ç `–†–ï–ñ–ò–ú: {mode}` –≤ –Ω–∞—á–∞–ª–µ —Å–æ–æ–±—â–µ–Ω–∏—è (case-insensitive –¥–ª—è —Ä—É—Å—Å–∫–∏—Ö –±—É–∫–≤ –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è)
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –≤—Å–µ —Ä–µ–∂–∏–º—ã (–∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω—ã–π —Å–ø–∏—Å–æ–∫):
  - –û–¶–ï–ù–ö–ê (default)
  - –ë–ò–ó–ù–ï–°-–ü–õ–ê–ù
  - –ú–ê–†–ö–ï–¢–ò–ù–ì
  - –ò–°–ü–û–õ–ù–ï–ù–ò–ï
  - –°–ê–ô–¢
  - –û–¢–ß–Å–¢ 1
  - –û–¢–ß–Å–¢ 2
  - –û–¢–ß–Å–¢ 3
  - –ü–û–ß–ï–ú–£_–°–ï–ô–ß–ê–°
  - –†–´–ù–û–ß–ù–´–ô_–†–ê–ó–†–´–í
  - –î–û–ö–ê–ó–ê–¢–ï–õ–¨–°–¢–í–ê

**–†–µ–∂–∏–º—ã –û–¢–ß–Å–¢ 1-3 (clarification):**
- **–û–¢–ß–Å–¢ 1**: Focus –Ω–∞ Section 5 (–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –∏ —Å–∏–≥–Ω–∞–ª—ã) ‚Äî –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ WB/Ozon –¥–∞–Ω–Ω—ã—Ö —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- **–û–¢–ß–Å–¢ 2**: Focus –Ω–∞ Section 6 (–ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π) ‚Äî –¥–µ—Ç–∞–ª—å–Ω—ã–π 30-day breakdown —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏ –∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏
- **–û–¢–ß–Å–¢ 3**: Focus –Ω–∞ Section 7 (–ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏) ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π roadmap 3-12 –º–µ—Å—è—Ü–µ–≤ —Å milestones –∏ resource planning

*Rationale:* –†–∞–∑–Ω—ã–µ —Ñ–∞–∑—ã –ø—Ä–æ–µ–∫—Ç–∞ —Ç—Ä–µ–±—É—é—Ç —Ä–∞–∑–Ω–æ–π –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏. Founder –º–æ–∂–µ—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç—å –û–¢–ß–Å–¢ 1 –¥–ª—è validation –¥–∞–Ω–Ω—ã—Ö, –∑–∞—Ç–µ–º –û–¢–ß–Å–¢ 2 –¥–ª—è execution planning, –∑–∞—Ç–µ–º –û–¢–ß–Å–¢ 3 –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.

**Total modes: 11** (–û–¶–ï–ù–ö–ê + 3 core business modes + –°–ê–ô–¢ + 3 –û–¢–ß–Å–¢ modes + 3 section-specific deep-dive modes)

- [ ] Default mode = `–û–¶–ï–ù–ö–ê`
- [ ] Invalid mode ‚Üí –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –ø–æ–¥—Å–∫–∞–∑–∫–æ–π + —Å–ø–∏—Å–æ–∫ –≤–∞–ª–∏–¥–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤ (–Ω–µ –ø–∞–¥–∞–µ—Ç)

---

### User Story 3 ‚Äî Data Validation & Citations (Priority: P1)

**User intent (RU):**
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–≤–µ—Ä—è–µ—Ç –æ—Ç—á—ë—Ç—É, –ø–æ—Ç–æ–º—É —á—Ç–æ:
1) –ª—é–±—ã–µ —á–∏—Å–ª–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏,
2) —Å—Å—ã–ª–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ Telegram,
3) –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å–≤–µ–∂–µ—Å—Ç–∏ –≤–∏–¥–∏–º—ã –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º.

**Why this priority:**
–î–æ–≤–µ—Ä–∏–µ –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–π ‚Äî –±–ª–æ–∫–µ—Ä –¥–ª—è adoption.

**Independent Test:**
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª—é–±–æ–π –æ—Ç–≤–µ—Ç —Å —á–∏—Å–ª–∞–º–∏ (—Ü–µ–Ω—ã/–∫–æ–ª-–≤–æ/—Ä–µ–π—Ç–∏–Ω–≥–∏):
- –Ω–∞–ª–∏—á–∏–µ —Ü–∏—Ç–∞—Ç (URL + timestamp)
- –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ—Å—Ç—å URL –≤ Telegram
- –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å–≤–µ–∂–µ—Å—Ç–∏

**Acceptance Criteria (must fully match Constitution):**
- [ ] –í—ã–ø–æ–ª–Ω–µ–Ω—ã –∫—Ä–∏—Ç–µ—Ä–∏–∏ AC-1..AC-4 –∏–∑ `.specify/constitution.md`
- [ ] –¶–∏—Ç–∞—Ç—ã –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã –≤ Telegram (URL –Ω–µ –¥–æ–ª–∂–µ–Ω –ª–æ–º–∞—Ç—å—Å—è —Ä–∞–∑–º–µ—Ç–∫–æ–π)
- [ ] –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å–≤–µ–∂–µ—Å—Ç–∏ `‚ö†Ô∏è` –∏ `üî¥` –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ Telegram –∏ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ—Å—ã–ª–∫–µ

---

### User Story 4 ‚Äî Error Recovery & Partial Results (Priority: P1)

**As a** user with limited patience  
**I want** partial results if WB/Ozon/Yandex fails  
**Instead of** a generic crash/"–û—à–∏–±–∫–∞" screen

**Why this priority:**
–í –†–§ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —á–∞—Å—Ç–æ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã (rate limit/–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏). UX –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –ø–æ–ª–µ–∑–Ω—ã–º.

**Independent Test:**
–ò–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (timeout/block) –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –±–æ—Ç:
- –Ω–µ –ø–∞–¥–∞–µ—Ç,
- –æ—Ç–¥–∞—ë—Ç —á–∞—Å—Ç–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç,
- –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç retry.

**Acceptance Criteria:**
- [ ] WB timeout ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ + `‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –æ—Ç {date}`
- [ ] Yandex blocked ‚Üí –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å Wordstat/—Ç—Ä–µ–Ω–¥—ã, –Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å WB/Ozon
- [ ] LLM fails ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å ¬´—Å—ã—Ä–æ–π¬ª –¥–∞—Ç–∞—Å–µ—Ç (–∫–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã/—Ü–µ–Ω—ã/—Å—Å—ã–ª–∫–∏) –±–µ–∑ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É: –±–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫—É `üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞`

---

### User Story 5 ‚Äî Telegram Shareability (Priority: P2)

**As a** founder pitching to a partner  
**I want** to forward bot analysis  
**So that** we discuss based on data

**Why this priority:**
–í–∏—Ä–∞–ª—å–Ω–æ—Å—Ç—å –∏ —Å–æ–≤–º–µ—Å—Ç–Ω–æ–µ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ ‚Äî –∫–ª—é—á–µ–≤–æ–π –∫–∞–Ω–∞–ª —Ä–æ—Å—Ç–∞.

**Independent Test:**
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ:
1) –∏—Ç–æ–≥–æ–≤—ã–π –æ—Ç–≤–µ—Ç –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Å–ª–∞—Ç—å,
2) –≤ –ø–µ—Ä–µ—Å–ª–∞–Ω–Ω–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ –æ—Å—Ç–∞—ë—Ç—Å—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –±–æ—Ç–∞,
3) —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ –∏ –∏–º–µ–µ—Ç ¬´preview/summary¬ª.

**Acceptance Criteria:**
- [ ] –ò—Ç–æ–≥–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–Ω–æ–ø–∫—É `üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è`
- [ ] –ö–Ω–æ–ø–∫–∞ –≤–µ–¥—ë—Ç –Ω–∞ share-flow (–Ω–∞–ø—Ä–∏–º–µ—Ä, `t.me/share/url?...`) –∏ –≤–∫–ª—é—á–∞–µ—Ç —Å—Å—ã–ª–∫—É `t.me/ideaplanneragent_bot`
- [ ] –ü–µ—Ä–µ—Å—ã–ª–∞–µ–º–∞—è –≤–µ—Ä—Å–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç **summary/preview**, –∞ –Ω–µ –ø–æ–ª–Ω—ã–π ¬´–ø–æ–ª–æ—Ç–Ω—è–Ω—ã–π¬ª —Ç–µ–∫—Å—Ç (–ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º/—Ç—Ä–µ–¥–æ–º)
- [ ] PDF export explicitly deferred to `002-export`

---

## Edge Cases

### Critical (must handle gracefully in MVP)
- [ ] **Empty/whitespace message**: Bot replies "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–∏—à–∏—Ç–µ –≤–∞—à—É –∏–¥–µ—é –≤ 1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö"
- [ ] **Telegram message limit (4096 chars)**: Split report into 2-3 sequential messages with "1/3", "2/3", "3/3" indicators
- [ ] **WB/Ozon rate limit**: Use cache (–¥–∞–∂–µ –µ—Å–ª–∏ >6h) + show `‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –æ—Ç {date}` + retry button
- [ ] **All sources unavailable**: Show error + cached data –æ—Ç previous similar query (–µ—Å–ª–∏ –µ—Å—Ç—å) + manual retry
- [ ] **LLM timeout (>120s)**: Return partial analysis (raw data + —á—Ç–æ —É—Å–ø–µ–ª–∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å)

### Important (should handle, can be basic)
- [ ] **Very long input (>500 words)**: Ask user to summarize in 1-2 sentences, OR take first 200 words
- [ ] **Media/files sent instead of text**: Reply "–Ø –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∏–¥–µ–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–∏—à–∏—Ç–µ –∏–¥–µ—é —Ç–µ–∫—Å—Ç–æ–º."
- [ ] **Partial source data** (e.g., WB prices –Ω–æ –Ω–µ—Ç ratings): Show available data + note "‚ö†Ô∏è –†–µ–π—Ç–∏–Ω–≥–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã"
- [ ] **Invalid mode typo** (e.g., "–†–ï–ñ–ò–ú: –ë–ò–ó–ù–ï–°"): Suggest closest match "–í–æ–∑–º–æ–∂–Ω–æ –≤—ã –∏–º–µ–ª–∏ –≤ –≤–∏–¥—É –ë–ò–ó–ù–ï–°-–ü–õ–ê–ù?"

### Nice-to-have (can defer to v1.1)
- [ ] **Multiple rapid requests from same user**: Queue + show "‚è≥ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∑–∞–ø—Ä–æ—Å..."
- [ ] **Concurrent requests from different users**: Handle via async processing (not blocking)
- [ ] **User edits message after sending**: Ignore edits (only process original message)

---

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: –°–∏—Å—Ç–µ–º–∞ MUST —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ Telegram bot –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–∫–æ–º–∞–Ω–¥—ã + —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è).
- **FR-002**: –ë–æ—Ç MUST –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ `/start` –∏ –æ–±—ä—è—Å–Ω—è—Ç—å —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ (–≤–∫–ª—é—á–∞—è —Ä–µ–∂–∏–º—ã).
- **FR-003**: –õ—é–±–æ–π —Ç–µ–∫—Å—Ç –∏–¥–µ–∏ MUST –∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –∞–Ω–∞–ª–∏–∑–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å `‚è≥ –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é...`.
- **FR-004**: –í—ã—Ö–æ–¥ MUST –±—ã—Ç—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º –∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ 7 —Å–µ–∫—Ü–∏–π.
- **FR-005**: –õ—é–±—ã–µ —á–∏—Å–ª–∞/—Ñ–∞–∫—Ç—ã MUST –∏–º–µ—Ç—å —Ü–∏—Ç–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ –ö–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏–∏ –∏ MUST –±—ã—Ç—å –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã –≤ Telegram.
- **FR-006**: –†–µ–∂–∏–º—ã MUST —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç—å—Å—è –∏–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ `–†–ï–ñ–ò–ú:` –∏ MUST –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∏–∑ US-2.
- **FR-007**: –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ —Å–∏—Å—Ç–µ–º–∞ MUST –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —á–∞—Å—Ç–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã + –∫–Ω–æ–ø–∫—É retry.
- **FR-008**: –°–∏—Å—Ç–µ–º–∞ MUST —Å–æ–±–ª—é–¥–∞—Ç—å ToS/—ç—Ç–∏–∫—É: –Ω–∏–∫–∞–∫–∏—Ö –æ–±—Ö–æ–¥–æ–≤ –∞–Ω—Ç–∏-–±–æ—Ç–∞/–ª–æ–≥–∏–Ω–∞/–ø–ª–∞—Ç–Ω—ã—Ö –≥–µ–π—Ç–æ–≤.
- **FR-009**: –ü–ª–∞—Ç–Ω—ã–µ/–ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ MUST –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ user-provided –¥–æ—Å—Ç—É–ø–µ (—Å–º. –ö–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏—é).
- **FR-010**: –°–∏—Å—Ç–µ–º–∞ MUST –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å WB/Ozon/Yandex –¥–∞–Ω–Ω—ã–µ –Ω–∞ 6 —á–∞—Å–æ–≤ (–¥–ª—è performance –∏ ToS compliance)
- **FR-011**: –ö—ç—à MUST –≤–∫–ª—é—á–∞—Ç—å timestamp, source URL, –∏ –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è citations
- **FR-012**: –ï—Å–ª–∏ –∫—ç—à >6 —á–∞—Å–æ–≤ ‚Üí —Å–∏—Å—Ç–µ–º–∞ MUST –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, –ø—Ä–∏ –æ—à–∏–±–∫–µ fallback –Ω–∞ –∫—ç—à —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º `‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –æ—Ç {date}`
- **FR-013**: –ö—ç—à MUST –±—ã—Ç—å per-query (—Ä–∞–∑–Ω—ã–µ –∏–¥–µ–∏ = —Ä–∞–∑–Ω—ã–µ –∫—ç—à-–∫–ª—é—á–∏), —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å cross-contamination

### Non-Functional Requirements

- **NFR-001**: p90 latency –ø–æ–ª–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ < 2 –º–∏–Ω—É—Ç (Telegram UX).
- **NFR-002**: –û—Ç–≤–µ—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ø–æ–¥ mobile: –∫–æ—Ä–æ—Ç–∫–∏–µ –∞–±–∑–∞—Ü—ã, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π.
- **NFR-003**: Observability & Monitoring
  - Structured logging (JSON format) –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
  - Log –∫–∞–∂–¥—ã–π API call: `{source: "wb", endpoint: "...", latency_ms: 450, result: "success"}`
  - Log –∫–∞–∂–¥—É—é –æ—à–∏–±–∫—É —Å context: `{user_id: "...", error_type: "timeout", source: "ozon", idea_hash: "..."}`
  - Metrics collection: `analysis_time_p90`, `cache_hit_rate`, `error_rate_by_source`
  - **No PII in logs**: user ideas hashed –∏–ª–∏ omitted, —Ç–æ–ª—å–∫–æ user_id –¥–ª—è tracing
  - Retention: logs 30 days, metrics 90 days (GDPR-friendly –¥–ª—è –†–§ users)

### Key Entities

- **TelegramUser**: –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram (–±–µ–∑ —Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–∏—à–Ω–∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö).
- **ChatContext**: —Ç–µ–∫—É—â–∏–π —á–∞—Ç/—Ç—Ä–µ–¥, —è–∑—ã–∫, –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º (–µ—Å–ª–∏ –µ—Å—Ç—å), –ø–æ—Å–ª–µ–¥–Ω—è—è –∏–¥–µ—è.
- **AnalysisJob**: –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞ –∞–Ω–∞–ª–∏–∑–∞ (status: queued/running/done/failed), timestamps.
- **DataSnapshot**: —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (WB/Ozon/Yandex) + timestamps + freshness.
- **Citation**: `{url, timestamp_msk, note}`.
- **BotMessage**: –æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ Telegram (text, parse_mode, buttons).

---

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: p90 –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –ø–æ US-1 < 2 –º–∏–Ω—É—Ç.
- **SC-002**: 0 —á–∏—Å–µ–ª/—Ü–µ–Ω/—Ñ–∞–∫—Ç–æ–≤ –±–µ–∑ —Ü–∏—Ç–∞—Ç –≤ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º –æ—Ç–≤–µ—Ç–µ (AC-1).
- **SC-003**: –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –±–æ—Ç –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —á–∞—Å—Ç–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç/—Å—ã—Ä–æ–π –¥–∞—Ç–∞—Å–µ—Ç –∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ ¬´–ø–∞–¥–∞–µ—Ç¬ª –º–æ–ª—á–∞ (US-4).
- **SC-004**: –í—Å–µ —Ä–µ–∂–∏–º—ã –∏–∑ US-2 —Ä–∞—Å–ø–æ–∑–Ω–∞—é—Ç—Å—è –∏ –¥–∞—é—Ç –æ—Ç–ª–∏—á–∏–º—ã–π –ø–æ —Ñ–æ–∫—É—Å—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –Ω–µ –ª–æ–º–∞—è 7 —Å–µ–∫—Ü–∏–π.
- **SC-005**: –ò—Ç–æ–≥–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Å–ª–∞—Ç—å, –∏ –æ–Ω–æ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Å—ã–ª–∫—É –Ω–∞ –±–æ—Ç–∞ + summary/preview (US-5).

---

## Technical Notes (binding for plan.md later)

- Python library: `python-telegram-bot`
- Production operation: **webhook mode** (polling –¥–æ–ø—É—Å—Ç–∏–º —Ç–æ–ª—å–∫–æ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
- Webhook URL: `https://{app_name}.railway.app/telegram/webhook`
- SSL certificate: Let's Encrypt (auto via Railway/Cloud Run)
- Webhook secret: required for request validation
- Deployment target (initial): Railway.app –∏–ª–∏ Google Cloud Run
- Formatting rules: max 3 sentences per paragraph; emojis allowed for structure; long report may be split into multiple Telegram messages

---

## Acceptance Criteria Appendix ‚Äî Citation Checklist (copied from Constitution)

**AC-1: Citation Format Compliance**
- [ ] –ö–∞–∂–¥–∞—è —Ü–µ–Ω–∞/—á–∏—Å–ª–æ –∏–º–µ–µ—Ç **URL + –¥–∞—Ç—É/–≤—Ä–µ–º—è**
- [ ] –§–æ—Ä–º–∞—Ç —Ü–∏—Ç–∞—Ç—ã: `[https://url, DD.MM.YYYY HH:MM, "description"]`
- [ ] –ù–µ—Ç —Ñ–∞–∫—Ç–æ–≤/—á–∏—Å–µ–ª –±–µ–∑ —Ü–∏—Ç–∞—Ç
- [ ] –°—Å—ã–ª–∫–∏ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã –∏ –≤–∞–ª–∏–¥–Ω—ã

**AC-2: Data Freshness Indicators**
- [ ] –î–∞–Ω–Ω—ã–µ ‚â§ 6 —á–∞—Å–æ–≤: –±–µ–∑ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
- [ ] –î–∞–Ω–Ω—ã–µ 6‚Äì48 —á–∞—Å–æ–≤: `‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –æ—Ç {date}`
- [ ] –î–∞–Ω–Ω—ã–µ > 48 —á–∞—Å–æ–≤: `üî¥ –î–∞–Ω–Ω—ã–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ (–æ—Ç {date})`

**AC-3: Source Validation**
- [ ] –ò—Å—Ç–æ—á–Ω–∏–∫ –∏–∑ approved list (WB, Ozon, Yandex/XML –∏/–∏–ª–∏ user-provided)
- [ ] –ò—Å—Ç–æ—á–Ω–∏–∫ –ù–ï —è–≤–ª—è–µ—Ç—Å—è ¬´–ø–ª–∞—Ç–Ω—ã–º/–ø—Ä–∏–≤–∞—Ç–Ω—ã–º¬ª –±–µ–∑ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –¥–æ—Å—Ç—É–ø–∞
- [ ] –°–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç ToS/—ç—Ç–∏–∫–µ

**AC-4: Data Accuracy**
- [ ] –ï—Å—Ç—å —Å–ª–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏: —á–∏—Å–ª–∞ –≤ –æ—Ç–≤–µ—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º
- [ ] –ï—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏—è ‚Üí –æ—à–∏–±–∫–∞/—Å—Ç–æ–ø, –±–µ–∑ ¬´—Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ¬ª –æ—Ç–≤–µ—Ç–∞
- [ ] –ï—Å–ª–∏ –∏—Å—Ç–æ—á–Ω–∏–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí graceful degrade + —á–µ—Å—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
